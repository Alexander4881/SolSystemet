<!DOCTYPE html>
<html>

<head>
    <title>Planets and moons</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./CSS/Bootstrap4/bootstrap.css">
    <link rel="stylesheet" href="./CSS/customCSS.css">
    <script src="./JavaScript/jQuery/jquery-3.4.1.js" rel="stylesheet" type="text/javascript"></script>
    <script src="./JavaScript/Bootstrap4/bootstrap.bundle.min.js" rel="stylesheet" type="text/javascript"></script>
</head>

<body>
    <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Planets<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./PlanetView.html">Planet Information</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Dropdown
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search For Planets" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav> -->

    <table class="w-100 h-100 rocket-background">

        <thead>
            <th class="w-5"></th>
            <th class="w-90"></th>
            <th class="w-5"></th>
        </thead>
        <tbody>
            <tr class="h-10">
                <td colspan="3">
                    <h1 class="display-4 text-center">byg din egen rumraket</h1>
                    <div class="row">
                        <div class="col-sm-2"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Mercury.png" height="50"
                                alt="mercury image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Venus.png" height="50"
                                alt="venus image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Earth.png" height="50"
                                alt="earth image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Mars.png" height="50"
                                alt="mars image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Jupiter.png" height="50"
                                alt="jupiter image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Saturn.png" height="50"
                                alt="saturn image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Uranus.png" height="50"
                                alt="uranus image"></div>
                        <div class="col-sm d-flex justify-content-center"><img src="./images/Neptune.png" height="50"
                                alt="neptune image"></div>
                        <div class="col-sm-2"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"></div>

                        <div class="col-sm-8 mt-2">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                                    aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>
                            </div>
                        </div>

                        <div class="col-sm-2"></div>
                    </div>
                </td>
            </tr>

            <tr class="h-25">
                <td> <button type="button" class="btn btn-dark" onclick="changeRocketPart('head',false)">
                        <</button> </td> <td rowspan="3" id="webgl">
                </td>
                <td> <button type="button" class="btn btn-dark float-right"
                        onclick="changeRocketPart('head',true)">></button>
                </td>
            </tr>

            <tr class="h-25">
                <td> <button type="button" class="btn btn-dark" onclick="changeRocketPart('body',false)">
                        <</button> </td> <td> <button type="button" class="btn btn-dark float-right"
                                onclick="changeRocketPart('body',true)">></button>
                </td>
            </tr>

            <tr class="h-25">
                <td> <button type="button" class="btn btn-dark" onclick="changeRocketPart('thruster',false)">
                        <</button> </td> <td> <button type="button" class="btn btn-dark float-right"
                                onclick="changeRocketPart('thruster',true)">></button> </td>
            </tr>
        </tbody>
    </table>

    <script src="./JavaScript/ThreeJS/three.min.js"></script>
    <script src="./JavaScript/ThreeJS/LoaderSupport.js"></script>
    <script src="./JavaScript/ThreeJS/MTLLoader.js"></script>
    <script src="./JavaScript/ThreeJS/OBJLoader2.js"></script>


    <script>
        // import * as THREE from "./JavaScript/ThreeJS/three.min.js";

        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, $('#webgl').innerWidth() / $('#webgl').innerHeight(), 0.1, 1000);

        var renderer = new THREE.WebGLRenderer();
        //var controls = new THREE.OrbitControls( camera, renderer.domElement );

        // const heads = ["RocketHead_001", "RocketHead_002", "RocketHead_003"];
        const heads = [ constructRocketPart("RocketHead_001","./CSS/3DObjects/RocketNose_001.obj", "./CSS/3DObjects/RocketNose_001.mtl", 9.3, 0, 0),
                        constructRocketPart("RocketHead_002","./CSS/3DObjects/RocketNose_001.obj", "./CSS/3DObjects/RocketNose_001.mtl", 9.3, 0, 0), 
                        constructRocketPart("RocketHead_003","./CSS/3DObjects/RocketNose_001.obj", "./CSS/3DObjects/RocketNose_001.mtl", 9.3, 0, 0),
                    ];
        let headSelected = 1;
        heads.forEach(rocketHead => {
                                loadOBJ(rocketHead.ObjPath,rocketHead.MltPath, rocketHead.StartPositionY, rocketHead.StartPositionX, rocketHead.StartPositionZ, rocketHead.Name);
                            });

        //      OBJPath                               MLTPath                                     Y     X  Z   Name
        // loadOBJ("./CSS/3DObjects/RocketNose_001.obj", "./CSS/3DObjects/RocketNose_001.mtl", 9.3, 0, 0, "RocketHead_001");
        // loadOBJ("./CSS/3DObjects/RocketNose_002.obj", "./CSS/3DObjects/RocketNose_002.mtl", 9.3, 8, 0, "RocketHead_002");
        // loadOBJ("./CSS/3DObjects/RocketNose_003.obj", "./CSS/3DObjects/RocketNose_003.mtl", 9.3, -8, 0, "RocketHead_003");

        const body = [constructRocketPart("Body_001", "./CSS/3DObjects/RocketBody_001.obj", "./CSS/3DObjects/RocketBody_001.mtl", 4, 0, 0),
                      constructRocketPart("Body_002", "./CSS/3DObjects/RocketBody_002.obj", "./CSS/3DObjects/RocketBody_002.mtl", 4, 8, 0),
                      constructRocketPart("Body_003", "./CSS/3DObjects/RocketBody_003.obj", "./CSS/3DObjects/RocketBody_003.mtl", 4, -8, 0)
                  ];
        let bodySelected = 1;
        heads.forEach(rocketBody => {
                                loadOBJ(rocketBody.ObjPath,rocketBody.MltPath, rocketBody.StartPositionY, rocketBody.StartPositionX, rocketBody.StartPositionZ, rocketBody.Name);
                            });
        // loadOBJ("./CSS/3DObjects/RocketBody_001.obj", "./CSS/3DObjects/RocketBody_001.mtl", 4, 0, 0, "Body_001");
        // loadOBJ("./CSS/3DObjects/RocketBody_002.obj", "./CSS/3DObjects/RocketBody_002.mtl", 4, 8, 0, "Body_002");
        // loadOBJ("./CSS/3DObjects/RocketBody_003.obj", "./CSS/3DObjects/RocketBody_003.mtl", 4, -8, 0, "Body_003");

        const thruster = [constructRocketPart("Rocket_001","./CSS/3DObjects/RocketThruster_001.obj", "./CSS/3DObjects/RocketThruster_001.mtl", 0, 0, 0),
                          constructRocketPart("Rocket_002","./CSS/3DObjects/RocketThruster_002.obj", "./CSS/3DObjects/RocketThruster_002.mtl", 0, 8, 0), 
                          constructRocketPart("Rocket_003", "./CSS/3DObjects/RocketThruster_003.obj", "./CSS/3DObjects/RocketThruster_003.mtl", 0, -8, 0)
                        ];
        let thrusterSelected = 1;
        heads.forEach(rocketThruster => {
                                loadOBJ(rocketThruster.ObjPath,rocketThruster.MltPath, rocketThruster.StartPositionY, rocketThruster.StartPositionX, rocketThruster.StartPositionZ, rocketThruster.Name);
                            });
        // loadOBJ("./CSS/3DObjects/RocketThruster_001.obj", "./CSS/3DObjects/RocketThruster_001.mtl", 0, 0, 0, "Rocket_001");
        // loadOBJ("./CSS/3DObjects/RocketThruster_002.obj", "./CSS/3DObjects/RocketThruster_002.mtl", 0, 8, 0, "Rocket_002");
        // loadOBJ("./CSS/3DObjects/RocketThruster_003.obj", "./CSS/3DObjects/RocketThruster_003.mtl", 0, -8, 0, "Rocket_003");


        renderer.setSize($('#webgl').innerWidth(), $('#webgl').innerHeight());
        renderer.setClearColor(0x6ee3f5, 1);
        $('#webgl').append(renderer.domElement);

        /**
         * This eliminates the redundance of having to type property names for a planet object.
         * @param {type} myName string
         * @param {type} myObjPath
         * @param {type} myMtlPath
         * @param {type} myStartPositionY
         * @param {type} myStartPositionX
         * @param {type} myStartPositionZ
         * @returns {constructRocketPart.mainAnonym$0}
         */
        function constructRocketPart(myName, myObjPath, myMtlPath, myStartPositionY, myStartPositionX, myStartPositionZ) {
            return {
                Name:myName,
                ObjPath:myObjPath,
                MltPath:myMtlPath,
                StartPositionY:myStartPositionY,
                StartPositionX:myStartPositionX,
                StartPositionZ:myStartPositionZ,
            };
        }

        function loadOBJ(objPath, mtlPath, positionY, positionX, positionZ, name) {
            const objLoader = new THREE.OBJLoader2();
            objLoader.loadMtl(mtlPath, null, (materials) => {
                objLoader.setMaterials(materials);
                objLoader.load(objPath, (event) => {
                    const root = event.detail.loaderRootNode;
                    root.position.set(positionX, positionY, positionZ);
                    root.name = name;
                    scene.add(root);
                });
            });
        }

        var light = new THREE.PointLight(0xffffff, 1, 200);
        light.position.set(50, 50, 50);
        scene.add(light);

        function changeRocketPart(rocketPart, forward) {
            switch (rocketPart) {
                case "head":
                    if (forward) {
                        if (headSelected < heads.length - 1) {
                            heads.forEach(rocketHead => {
                                var screenObj = scene.getObjectByName(rocketHead.Name);
                                screenObj.translateX(8);
                            });
                            headSelected++;
                        }
                    } else {
                        if (headSelected >= 1) {
                            headSelected--;
                            heads.forEach(rocketHead => {
                                var screenObj = scene.getObjectByName(rocketHead.Name);
                                screenObj.translateX(-8);
                            });
                        }
                    }
                    break;

                case "body":
                    if (forward) {
                        if (bodySelected < body.length - 1) {
                            body.forEach(rocketBody => {
                                var screenObj = scene.getObjectByName(rocketBody.Name);
                                screenObj.translateX(8);
                            });
                            bodySelected++;
                        }
                    } else {
                        if (bodySelected >= 1) {
                            bodySelected--;
                            body.forEach(rocketBody => {
                                var screenObj = scene.getObjectByName(rocketBody.Name);
                                screenObj.translateX(-8);
                            });
                        }
                    }
                    break;

                case "thruster":
                    if (forward) {
                        if (thrusterSelected < thruster.length - 1) {
                            thruster.forEach(rocketThruster => {
                                var screenObj = scene.getObjectByName(rocketThruster.Name);
                                screenObj.translateX(8);
                            });
                            thrusterSelected++;
                        }
                    } else {

                        if (thrusterSelected >= 1) {
                            thrusterSelected--;
                            thruster.forEach(rocketThruster => {
                                var screenObj = scene.getObjectByName(rocketThruster.Name);
                                screenObj.translateX(-8);
                            });
                        }
                    }
                    break;

                default:
                    console.error("not valid paramerters");
                    break;
            }
        }

        function spaceOBJs(rocketParts) {
            for (i = 0; i < rocketParts.length; i++) {
                console.log(i);
            }
        }

        camera.position.z = 15;
        camera.position.y = 5;

        //controls.target = new THREE.Vector3(0, 5, 0);

        //controls.update();

        function animate() {
            requestAnimationFrame(animate);

            // required if controls.enableDamping or controls.autoRotate are set to true
            // controls.update();

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>

</html>